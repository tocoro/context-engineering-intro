name: "Multi-Agent System: Research Agent with Email Draft Sub-Agent"
description: |

## ç›®çš„
ãƒ—ãƒ©ã‚¤ãƒãƒªãƒªã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒBrave Search APIã‚’ä½¿ç”¨ã—ã€ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ãƒ¡ãƒ¼ãƒ«ãƒ‰ãƒ©ãƒ•ãƒˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆGmail APIä½¿ç”¨ï¼‰ã‚’æŒã¤Pydantic AIãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã€‚ã“ã‚Œã¯å¤–éƒ¨APIçµ±åˆã‚’ä¼´ã†ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ»ã‚¢ã‚ºãƒ»ãƒ„ãƒ¼ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè¨¼ã—ã¾ã™ã€‚

## æ ¸ã¨ãªã‚‹åŸå‰‡
1. **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒç‹**: å¿…è¦ãªã™ã¹ã¦ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€ä¾‹ã€æ³¨æ„ç‚¹ã‚’å«ã‚ã‚‹
2. **æ¤œè¨¼ãƒ«ãƒ¼ãƒ—**: AIãŒå®Ÿè¡Œã—ã¦ä¿®æ­£ã§ãã‚‹å®Ÿè¡Œå¯èƒ½ãªãƒ†ã‚¹ãƒˆ/ãƒªãƒ³ãƒˆã‚’æä¾›
3. **æƒ…å ±å¯†åº¦**: ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨
4. **æ®µéšçš„æˆåŠŸ**: ã‚·ãƒ³ãƒ—ãƒ«ã«é–‹å§‹ã—ã€æ¤œè¨¼ã—ã€ãã®å¾Œå¼·åŒ–

---

## ç›®æ¨™
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒCLIçµŒç”±ã§ãƒˆãƒ”ãƒƒã‚¯ã‚’ãƒªã‚µãƒ¼ãƒã§ãã€ãƒªã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒãƒ¡ãƒ¼ãƒ«ãƒ‰ãƒ©ãƒ•ãƒˆã‚¿ã‚¹ã‚¯ã‚’ãƒ¡ãƒ¼ãƒ«ãƒ‰ãƒ©ãƒ•ãƒˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å§”è­²ã§ãã‚‹æœ¬ç•ªæº–å‚™å®Œäº†ã®ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã‚’ä½œæˆã€‚ã‚·ã‚¹ãƒ†ãƒ ã¯è¤‡æ•°ã®LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’ã‚µãƒãƒ¼ãƒˆã—ã€APIèªè¨¼ã‚’å®‰å…¨ã«å‡¦ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## ç†ç”±
- **ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤**: ãƒªã‚µãƒ¼ãƒã¨ãƒ¡ãƒ¼ãƒ«ãƒ‰ãƒ©ãƒ•ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è‡ªå‹•åŒ–
- **çµ±åˆ**: é«˜åº¦ãªPydantic AIãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè¨¼
- **è§£æ±ºã™ã‚‹å•é¡Œ**: ãƒªã‚µãƒ¼ãƒãƒ™ãƒ¼ã‚¹ã®ãƒ¡ãƒ¼ãƒ«ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ‰‹å‹•ä½œæ¥­ã‚’å‰Šæ¸›

## ä½•ã‚’
ä»¥ä¸‹ã®CLIãƒ™ãƒ¼ã‚¹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼š
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒªã‚µãƒ¼ãƒã‚¯ã‚¨ãƒªã‚’å…¥åŠ›
- ãƒªã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒBrave APIã‚’ä½¿ç”¨ã—ã¦æ¤œç´¢
- ãƒªã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒGmailãƒ‰ãƒ©ãƒ•ãƒˆã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ãƒ¡ãƒ¼ãƒ«ãƒ‰ãƒ©ãƒ•ãƒˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å‘¼ã³å‡ºã—å¯èƒ½
- çµæœãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°

### æˆåŠŸåŸºæº–
- [ ] ãƒªã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒBrave APIçµŒç”±ã§æ­£å¸¸ã«æ¤œç´¢
- [ ] ãƒ¡ãƒ¼ãƒ«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒé©åˆ‡ãªèªè¨¼ã§Gmailãƒ‰ãƒ©ãƒ•ãƒˆã‚’ä½œæˆ
- [ ] ãƒªã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ãƒ¡ãƒ¼ãƒ«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å‘¼ã³å‡ºã—å¯èƒ½
- [ ] CLIãŒãƒ„ãƒ¼ãƒ«å¯è¦–æ€§ã‚’ä¼´ã†ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æä¾›
- [ ] ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒåˆæ ¼ã—ã€ã‚³ãƒ¼ãƒ‰ãŒå“è³ªåŸºæº–ã‚’æº€ãŸã™

## å¿…è¦ãªã™ã¹ã¦ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨å‚ç…§
```yaml
# å¿…ãšèª­ã‚€ - ã“ã‚Œã‚‰ã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«å«ã‚ã‚‹
- url: https://ai.pydantic.dev/agents/
  why: ã‚³ã‚¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä½œæˆãƒ‘ã‚¿ãƒ¼ãƒ³
  
- url: https://ai.pydantic.dev/multi-agent-applications/
  why: ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ç‰¹ã«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ»ã‚¢ã‚ºãƒ»ãƒ„ãƒ¼ãƒ«
  
- url: https://developers.google.com/gmail/api/guides/sending
  why: Gmail APIèªè¨¼ã¨ãƒ‰ãƒ©ãƒ•ãƒˆä½œæˆ
  
- url: https://api-dashboard.search.brave.com/app/documentation
  why: Brave Search API RESTã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  
- file: examples/agent/agent.py
  why: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä½œæˆã€ãƒ„ãƒ¼ãƒ«ç™»éŒ²ã€ä¾å­˜é–¢ä¿‚ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
  
- file: examples/agent/providers.py
  why: ãƒãƒ«ãƒãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼LLMè¨­å®šãƒ‘ã‚¿ãƒ¼ãƒ³
  
- file: examples/cli.py
  why: ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ãƒ„ãƒ¼ãƒ«å¯è¦–æ€§ã‚’ä¼´ã†CLIæ§‹é€ 

- url: https://github.com/googleworkspace/python-samples/blob/main/gmail/snippet/send%20mail/create_draft.py
  why: å…¬å¼Gmailãƒ‰ãƒ©ãƒ•ãƒˆä½œæˆä¾‹
```

### ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ãƒ„ãƒªãƒ¼
```bash
.
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ agent/
â”‚   â”‚   â”œâ”€â”€ agent.py
â”‚   â”‚   â”œâ”€â”€ providers.py
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ cli.py
â”œâ”€â”€ PRPs/
â”‚   â””â”€â”€ templates/
â”‚       â””â”€â”€ prp_base.md
â”œâ”€â”€ INITIAL.md
â”œâ”€â”€ CLAUDE.md
â””â”€â”€ requirements.txt
```

### è¿½åŠ ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚€å¸Œæœ›ã™ã‚‹ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ãƒ„ãƒªãƒ¼
```bash
.
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ __init__.py               # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åˆæœŸåŒ–
â”‚   â”œâ”€â”€ research_agent.py         # Brave Searchã‚’æŒã¤ãƒ—ãƒ©ã‚¤ãƒãƒªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ email_agent.py           # Gmailæ©Ÿèƒ½ã‚’æŒã¤ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ providers.py             # LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®š
â”‚   â””â”€â”€ models.py                # ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ç”¨ã®Pydanticãƒ¢ãƒ‡ãƒ«
â”œâ”€â”€ tools/
â”‚   â”œâ”€â”€ __init__.py              # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åˆæœŸåŒ–
â”‚   â”œâ”€â”€ brave_search.py          # Brave Search APIçµ±åˆ
â”‚   â””â”€â”€ gmail_tool.py            # Gmail APIçµ±åˆ
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ __init__.py              # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åˆæœŸåŒ–
â”‚   â””â”€â”€ settings.py              # ç’°å¢ƒã¨è¨­å®šç®¡ç†
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py              # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åˆæœŸåŒ–
â”‚   â”œâ”€â”€ test_research_agent.py   # ãƒªã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ test_email_agent.py      # ãƒ¡ãƒ¼ãƒ«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ test_brave_search.py     # Braveæ¤œç´¢ãƒ„ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ test_gmail_tool.py       # Gmailãƒ„ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ test_cli.py              # CLIãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ cli.py                       # CLIã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”œâ”€â”€ .env.example                 # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ requirements.txt             # æ›´æ–°ã•ã‚ŒãŸä¾å­˜é–¢ä¿‚
â”œâ”€â”€ README.md                    # åŒ…æ‹¬çš„ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â””â”€â”€ credentials/.gitkeep         # Gmailèªè¨¼æƒ…å ±ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
```

### æ—¢çŸ¥ã®è½ã¨ã—ç©´ã¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ç™–
```python
# é‡è¦: Pydantic AIã¯å…¨ä½“ã§éåŒæœŸã‚’å¿…è¦ã¨ã™ã‚‹ - éåŒæœŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§åŒæœŸé–¢æ•°ã‚’ä½¿ç”¨ã—ãªã„
# é‡è¦: Gmail APIã¯åˆå›å®Ÿè¡Œæ™‚ã«OAuth2ãƒ•ãƒ­ãƒ¼ã‚’å¿…è¦ã¨ã™ã‚‹ - credentials.jsonãŒå¿…è¦
# é‡è¦: Brave APIã«ã¯ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãŒã‚ã‚‹ - ç„¡æ–™æ ã§æœˆ2000ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
# é‡è¦: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ»ã‚¢ã‚ºãƒ»ãƒ„ãƒ¼ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ãƒˆãƒ¼ã‚¯ãƒ³è¿½è·¡ã®ãŸã‚ã«ctx.usageã‚’æ¸¡ã™å¿…è¦ãŒã‚ã‚‹
# é‡è¦: Gmailãƒ‰ãƒ©ãƒ•ãƒˆã¯é©åˆ‡ãªMIMEãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒå¿…è¦
# é‡è¦: ã‚ˆã‚Šã‚¯ãƒªãƒ¼ãƒ³ãªã‚³ãƒ¼ãƒ‰ã®ãŸã‚ã«å¸¸ã«çµ¶å¯¾ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨
# é‡è¦: æ©Ÿå¯†èªè¨¼æƒ…å ±ã¯.envã«ä¿å­˜ã—ã€ã‚³ãƒŸãƒƒãƒˆã—ãªã„
```

## å®Ÿè£…é’å†™çœŸ

### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã¨æ§‹é€ 

```python
# models.py - ã‚³ã‚¢ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
from pydantic import BaseModel, Field
from typing import List, Optional
from datetime import datetime

class ResearchQuery(BaseModel):
    query: str = Field(..., description="èª¿æŸ»ã™ã‚‹ãƒªã‚µãƒ¼ãƒãƒˆãƒ”ãƒƒã‚¯")
    max_results: int = Field(10, ge=1, le=50)
    include_summary: bool = Field(True)

class BraveSearchResult(BaseModel):
    title: str
    url: str
    description: str
    score: float = Field(0.0, ge=0.0, le=1.0)

class EmailDraft(BaseModel):
    to: List[str] = Field(..., min_items=1)
    subject: str = Field(..., min_length=1)
    body: str = Field(..., min_length=1)
    cc: Optional[List[str]] = None
    bcc: Optional[List[str]] = None

class ResearchEmailRequest(BaseModel):
    research_query: str
    email_context: str = Field(..., description="ãƒ¡ãƒ¼ãƒ«ç”Ÿæˆã®ãŸã‚ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ")
    recipient_email: str
```

### å®Œäº†ã™ã¹ãã‚¿ã‚¹ã‚¯ã®ãƒªã‚¹ãƒˆ

```yaml
ã‚¿ã‚¹ã‚¯1: è¨­å®šã¨ç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
CREATE config/settings.py:
  - ãƒ‘ã‚¿ãƒ¼ãƒ³: ä¾‹ãŒos.getenvã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«pydantic-settingsã‚’ä½¿ç”¨
  - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã¿
  - å¿…è¦ãªAPIã‚­ãƒ¼ã®å­˜åœ¨ã‚’æ¤œè¨¼

CREATE .env.example:
  - èª¬æ˜ä»˜ãã®ã™ã¹ã¦ã®å¿…è¦ãªç’°å¢ƒå¤‰æ•°ã‚’å«ã‚ã‚‹
  - examples/README.mdã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã†

ã‚¿ã‚¹ã‚¯2: Brave Searchãƒ„ãƒ¼ãƒ«ã®å®Ÿè£…
CREATE tools/brave_search.py:
  - ãƒ‘ã‚¿ãƒ¼ãƒ³: examples/agent/tools.pyã®ã‚ˆã†ãªéåŒæœŸé–¢æ•°
  - httpxã‚’ä½¿ç”¨ã—ãŸã‚·ãƒ³ãƒ—ãƒ«ãªRESTã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆæ—¢ã«requirementsã«å«ã¾ã‚Œã¦ã„ã‚‹ï¼‰
  - ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã¨ã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«å‡¦ç†
  - æ§‹é€ åŒ–ã•ã‚ŒãŸBraveSearchResultãƒ¢ãƒ‡ãƒ«ã‚’è¿”ã™

ã‚¿ã‚¹ã‚¯3: Gmailãƒ„ãƒ¼ãƒ«ã®å®Ÿè£…
CREATE tools/gmail_tool.py:
  - ãƒ‘ã‚¿ãƒ¼ãƒ³: Gmailã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‹ã‚‰OAuth2ãƒ•ãƒ­ãƒ¼ã«å¾“ã†
  - credentials/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«token.jsonã‚’ä¿å­˜
  - é©åˆ‡ãªMIMEã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§ãƒ‰ãƒ©ãƒ•ãƒˆã‚’ä½œæˆ
  - èªè¨¼æ›´æ–°ã‚’è‡ªå‹•çš„ã«å‡¦ç†

ã‚¿ã‚¹ã‚¯4: ãƒ¡ãƒ¼ãƒ«ãƒ‰ãƒ©ãƒ•ãƒˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä½œæˆ
CREATE agents/email_agent.py:
  - ãƒ‘ã‚¿ãƒ¼ãƒ³: examples/agent/agent.pyæ§‹é€ ã«å¾“ã†
  - deps_typeãƒ‘ã‚¿ãƒ¼ãƒ³ã§Agentã‚’ä½¿ç”¨
  - gmail_toolã‚’@agent.toolã¨ã—ã¦ç™»éŒ²
  - EmailDraftãƒ¢ãƒ‡ãƒ«ã‚’è¿”ã™

ã‚¿ã‚¹ã‚¯5: ãƒªã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä½œæˆ
CREATE agents/research_agent.py:
  - ãƒ‘ã‚¿ãƒ¼ãƒ³: Pydantic AIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰ã®ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³
  - brave_searchã‚’ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ç™»éŒ²
  - email_agent.run()ã‚’ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ç™»éŒ²
  - ä¾å­˜æ€§æ³¨å…¥ã®ãŸã‚ã«RunContextã‚’ä½¿ç”¨

ã‚¿ã‚¹ã‚¯6: CLIã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å®Ÿè£…
CREATE cli.py:
  - ãƒ‘ã‚¿ãƒ¼ãƒ³: examples/cli.pyã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã†
  - ãƒ„ãƒ¼ãƒ«å¯è¦–æ€§ã‚’ä¼´ã†ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰å‡ºåŠ›
  - asyncio.run()ã§éåŒæœŸã‚’é©åˆ‡ã«å‡¦ç†
  - ä¼šè©±ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ãŸã‚ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

ã‚¿ã‚¹ã‚¯7: åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã®è¿½åŠ 
CREATE tests/:
  - ãƒ‘ã‚¿ãƒ¼ãƒ³: ä¾‹ã®ãƒ†ã‚¹ãƒˆæ§‹é€ ã‚’åæ˜ 
  - å¤–éƒ¨APIå‘¼ã³å‡ºã—ã‚’ãƒ¢ãƒƒã‚¯
  - ãƒãƒƒãƒ”ãƒ¼ãƒ‘ã‚¹ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã€ã‚¨ãƒ©ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆ
  - 80%ä»¥ä¸Šã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç¢ºä¿

ã‚¿ã‚¹ã‚¯8: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä½œæˆ
CREATE README.md:
  - ãƒ‘ã‚¿ãƒ¼ãƒ³: examples/README.mdæ§‹é€ ã«å¾“ã†
  - ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€ä½¿ç”¨æ–¹æ³•ã‚’å«ã‚ã‚‹
  - APIã‚­ãƒ¼è¨­å®šæ‰‹é †
  - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³
```

### ã‚¿ã‚¹ã‚¯ã”ã¨ã®ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰

```python
# ã‚¿ã‚¹ã‚¯2: Brave Searchãƒ„ãƒ¼ãƒ«
async def search_brave(query: str, api_key: str, count: int = 10) -> List[BraveSearchResult]:
    # ãƒ‘ã‚¿ãƒ¼ãƒ³: ä¾‹ãŒaiohttpã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«httpxã‚’ä½¿ç”¨
    async with httpx.AsyncClient() as client:
        headers = {"X-Subscription-Token": api_key}
        params = {"q": query, "count": count}
        
        # è½ã¨ã—ç©´: Brave APIã¯APIã‚­ãƒ¼ãŒç„¡åŠ¹ãªå ´åˆ401ã‚’è¿”ã™
        response = await client.get(
            "https://api.search.brave.com/res/v1/web/search",
            headers=headers,
            params=params,
            timeout=30.0  # é‡è¦: ãƒãƒ³ã‚°ã‚’é¿ã‘ã‚‹ãŸã‚ã«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’è¨­å®š
        )
        
        # ãƒ‘ã‚¿ãƒ¼ãƒ³: æ§‹é€ åŒ–ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        if response.status_code != 200:
            raise BraveAPIError(f"API returned {response.status_code}")
        
        # Pydanticã§è§£æã¨æ¤œè¨¼
        data = response.json()
        return [BraveSearchResult(**result) for result in data.get("web", {}).get("results", [])]

# ã‚¿ã‚¹ã‚¯5: ãƒ¡ãƒ¼ãƒ«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦æŒã¤ãƒªã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
@research_agent.tool
async def create_email_draft(
    ctx: RunContext[AgentDependencies],
    recipient: str,
    subject: str,
    context: str
) -> str:
    """ãƒªã‚µãƒ¼ãƒã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«åŸºã¥ã„ã¦ãƒ¡ãƒ¼ãƒ«ãƒ‰ãƒ©ãƒ•ãƒˆã‚’ä½œæˆã€‚"""
    # é‡è¦: ãƒˆãƒ¼ã‚¯ãƒ³è¿½è·¡ã®ãŸã‚ã«usageã‚’æ¸¡ã™
    result = await email_agent.run(
        f"Create an email to {recipient} about: {context}",
        deps=EmailAgentDeps(subject=subject),
        usage=ctx.usage  # ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
    )
    
    return f"Draft created with ID: {result.data}"
```

### çµ±åˆãƒã‚¤ãƒ³ãƒˆ
```yaml
ç’°å¢ƒ:
  - add to: .env
  - vars: |
      # LLMè¨­å®š
      LLM_PROVIDER=openai
      LLM_API_KEY=sk-...
      LLM_MODEL=gpt-4
      
      # Brave Search
      BRAVE_API_KEY=BSA...
      
      # Gmailï¼ˆcredentials.jsonã¸ã®ãƒ‘ã‚¹ï¼‰
      GMAIL_CREDENTIALS_PATH=./credentials/credentials.json
      
è¨­å®š:
  - Gmail OAuth: åˆå›å®Ÿè¡Œæ™‚ã«ãƒ–ãƒ©ã‚¦ã‚¶ãŒé–‹ã„ã¦èªè¨¼
  - ãƒˆãƒ¼ã‚¯ãƒ³ä¿å­˜: ./credentials/token.jsonï¼ˆè‡ªå‹•ä½œæˆï¼‰
  
ä¾å­˜é–¢ä¿‚:
  - requirements.txtã‚’ä»¥ä¸‹ã§æ›´æ–°:
    - google-api-python-client
    - google-auth-httplib2
    - google-auth-oauthlib
```

## æ¤œè¨¼ãƒ«ãƒ¼ãƒ—

### ãƒ¬ãƒ™ãƒ«1: æ§‹æ–‡ã¨ã‚¹ã‚¿ã‚¤ãƒ«
```bash
# ã“ã‚Œã‚‰ã‚’æœ€åˆã«å®Ÿè¡Œ - ç¶šè¡Œå‰ã«ã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£
ruff check . --fix              # ã‚¹ã‚¿ã‚¤ãƒ«å•é¡Œã‚’è‡ªå‹•ä¿®æ­£
mypy .                          # å‹ãƒã‚§ãƒƒã‚¯

# æœŸå¾…: ã‚¨ãƒ©ãƒ¼ãªã—ã€‚ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹å ´åˆã€èª­ã¿å–ã£ã¦ä¿®æ­£ã€‚
```

### ãƒ¬ãƒ™ãƒ«2: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
```python
# test_research_agent.py
async def test_research_with_brave():
    """ãƒªã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒæ­£ã—ãæ¤œç´¢ã™ã‚‹ã“ã¨ã‚’ãƒ†ã‚¹ãƒˆ"""
    agent = create_research_agent()
    result = await agent.run("AI safety research")
    assert result.data
    assert len(result.data) > 0

async def test_research_creates_email():
    """ãƒªã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒãƒ¡ãƒ¼ãƒ«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å‘¼ã³å‡ºã›ã‚‹ã“ã¨ã‚’ãƒ†ã‚¹ãƒˆ"""
    agent = create_research_agent()
    result = await agent.run(
        "Research AI safety and draft email to john@example.com"
    )
    assert "draft_id" in result.data

# test_email_agent.py  
def test_gmail_authentication(monkeypatch):
    """Gmail OAuthãƒ•ãƒ­ãƒ¼å‡¦ç†ã‚’ãƒ†ã‚¹ãƒˆ"""
    monkeypatch.setenv("GMAIL_CREDENTIALS_PATH", "test_creds.json")
    tool = GmailTool()
    assert tool.service is not None

async def test_create_draft():
    """é©åˆ‡ãªã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§ãƒ‰ãƒ©ãƒ•ãƒˆä½œæˆã‚’ãƒ†ã‚¹ãƒˆ"""
    agent = create_email_agent()
    result = await agent.run(
        "Create email to test@example.com about AI research"
    )
    assert result.data.get("draft_id")
```

```bash
# åˆæ ¼ã™ã‚‹ã¾ã§ãƒ†ã‚¹ãƒˆã‚’åå¾©çš„ã«å®Ÿè¡Œ:
pytest tests/ -v --cov=agents --cov=tools --cov-report=term-missing

# å¤±æ•—ã™ã‚‹å ´åˆ: ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚’ãƒ‡ãƒãƒƒã‚°ã—ã€ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ã€å†å®Ÿè¡Œ
```

### ãƒ¬ãƒ™ãƒ«3: çµ±åˆãƒ†ã‚¹ãƒˆ
```bash
# CLIå¯¾è©±ã‚’ãƒ†ã‚¹ãƒˆ
python cli.py

# æœŸå¾…ã•ã‚Œã‚‹å¯¾è©±:
# You: Research latest AI safety developments
# ğŸ¤– Assistant: [ãƒªã‚µãƒ¼ãƒçµæœã‚’ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°]
# ğŸ›  Tools Used:
#   1. brave_search (query='AI safety developments', limit=10)
#
# You: Create an email draft about this to john@example.com  
# ğŸ¤– Assistant: [ãƒ‰ãƒ©ãƒ•ãƒˆã‚’ä½œæˆ]
# ğŸ›  Tools Used:
#   1. create_email_draft (recipient='john@example.com', ...)

# ä½œæˆã•ã‚ŒãŸãƒ‰ãƒ©ãƒ•ãƒˆã«ã¤ã„ã¦Gmailãƒ‰ãƒ©ãƒ•ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã‚’ç¢ºèª
```

## æœ€çµ‚æ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒåˆæ ¼: `pytest tests/ -v`
- [ ] ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°ã‚¨ãƒ©ãƒ¼ãªã—: `ruff check .`
- [ ] å‹ã‚¨ãƒ©ãƒ¼ãªã—: `mypy .`
- [ ] Gmail OAuthãƒ•ãƒ­ãƒ¼ãŒå‹•ä½œï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ãŒé–‹ãã€ãƒˆãƒ¼ã‚¯ãƒ³ãŒä¿å­˜ã•ã‚Œã‚‹ï¼‰
- [ ] Brave SearchãŒçµæœã‚’è¿”ã™
- [ ] ãƒªã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒãƒ¡ãƒ¼ãƒ«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ­£å¸¸ã«å‘¼ã³å‡ºã™
- [ ] CLIãŒãƒ„ãƒ¼ãƒ«å¯è¦–æ€§ã‚’ä¼´ã†ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°
- [ ] ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ãŒé©åˆ‡ã«å‡¦ç†ã•ã‚Œã‚‹
- [ ] READMEã«æ˜ç¢ºãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ãŒå«ã¾ã‚Œã‚‹
- [ ] .env.exampleã«ã™ã¹ã¦ã®å¿…è¦ãªå¤‰æ•°ãŒã‚ã‚‹

---

## é¿ã‘ã‚‹ã¹ãã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³
- âŒ APIã‚­ãƒ¼ã‚’ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã—ãªã„ - ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨
- âŒ éåŒæœŸã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§åŒæœŸé–¢æ•°ã‚’ä½¿ç”¨ã—ãªã„
- âŒ Gmailã®OAuthãƒ•ãƒ­ãƒ¼ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ãªã„
- âŒ APIã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’ç„¡è¦–ã—ãªã„
- âŒ ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‘¼ã³å‡ºã—ã§ctx.usageã‚’æ¸¡ã™ã“ã¨ã‚’å¿˜ã‚Œãªã„
- âŒ credentials.jsonã‚„token.jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒŸãƒƒãƒˆã—ãªã„

## ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢: 9/10

é«˜ã„ä¿¡é ¼åº¦ã®ç†ç”±ï¼š
- ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã®æ˜ç¢ºãªä¾‹ã«å¾“ãˆã‚‹
- å¤–éƒ¨APIãŒååˆ†ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–ã•ã‚Œã¦ã„ã‚‹
- ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã®ç¢ºç«‹ã•ã‚ŒãŸãƒ‘ã‚¿ãƒ¼ãƒ³
- åŒ…æ‹¬çš„ãªæ¤œè¨¼ã‚²ãƒ¼ãƒˆ

Gmail OAuthåˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—UXã«ã¤ã„ã¦ã¯è»½å¾®ãªä¸ç¢ºå®Ÿæ€§ãŒã‚ã‚‹ãŒã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæ˜ç¢ºãªã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã‚’æä¾›ã—ã¦ã„ã‚‹ã€‚